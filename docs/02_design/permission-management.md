# æ¨©é™ç®¡ç†ãƒšãƒ¼ã‚¸ å®šç¾©ãƒ»è¨­è¨ˆãƒ»å®Ÿè¡Œã‚¬ã‚¤ãƒ‰

## æ¦‚è¦

Admin ãƒ­ãƒ¼ãƒ«ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªæ¨©é™ç®¡ç†ãƒšãƒ¼ã‚¸ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ‹›å¾…ãƒ»ãƒ­ãƒ¼ãƒ«å¤‰æ›´ãƒ»ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç„¡åŠ¹åŒ–ã‚’è¡Œã†ã€‚

**ã‚¢ã‚¯ã‚»ã‚¹URL:** `/settings/users`
**å¿…è¦ãƒ­ãƒ¼ãƒ«:** ADMIN ã®ã¿

---

## ç”»é¢æ§‹æˆ

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ç”»é¢ (SCR-003: /settings/users)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â† è¨­å®š]  ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ” ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¤œç´¢... â”‚  â”‚ + ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ‹›å¾…          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  ãƒ­ãƒ¼ãƒ«: [ã™ã¹ã¦ â–¼]  ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: [ã™ã¹ã¦ â–¼]              â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ åå‰          â”‚ ãƒ¡ãƒ¼ãƒ«           â”‚ ãƒ­ãƒ¼ãƒ« â”‚ çŠ¶æ…‹  â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ å±±ç”° å¤ªéƒ     â”‚ yamada@ex.com   â”‚ Admin  â”‚ æœ‰åŠ¹  â”‚  â”‚
â”‚  â”‚ ä½è—¤ èŠ±å­     â”‚ sato@ex.com     â”‚ Viewer â”‚ æœ‰åŠ¹  â”‚  â”‚
â”‚  â”‚ éˆ´æœ¨ ä¸€éƒ     â”‚ suzuki@ex.com   â”‚ Viewer â”‚ æœ‰åŠ¹  â”‚  â”‚
â”‚  â”‚ ç”°ä¸­ æ¬¡éƒ     â”‚ tanaka@ex.com   â”‚ Viewer â”‚ æ‹›å¾…ä¸­â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  1-4 / 12ä»¶  [< å‰ã¸] [1] [2] [3] [æ¬¡ã¸ >]              â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…ãƒ¢ãƒ¼ãƒ€ãƒ«

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ‹›å¾…                [Ã—]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ *                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ user@example.com             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                      â”‚
â”‚  åå‰                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                      â”‚
â”‚  ãƒ­ãƒ¼ãƒ« *                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Viewer                    â–¼  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â€» Viewer: é–²è¦§ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ»ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆâ”‚
â”‚  â€» Admin: å…¨æ©Ÿèƒ½ + ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†      â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ã‚­ãƒ£ãƒ³ã‚»ãƒ« â”‚  â”‚  æ‹›å¾…ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ãƒ»ãƒ­ãƒ¼ãƒ«å¤‰æ›´ãƒ‘ãƒãƒ«ï¼ˆè¡Œã‚¯ãƒªãƒƒã‚¯æ™‚ã®ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ãƒãƒ«ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°              [Ã—]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                   â”‚
â”‚  [ã‚¢ãƒã‚¿ãƒ¼]  å±±ç”° å¤ªéƒ             â”‚
â”‚  yamada@example.com               â”‚
â”‚  èªè¨¼æ–¹å¼: Google SSO              â”‚
â”‚                                   â”‚
â”‚  â”€â”€ ãƒ­ãƒ¼ãƒ«è¨­å®š â”€â”€                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Admin                 â–¼  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  [å¤‰æ›´ã‚’ä¿å­˜]                      â”‚
â”‚                                   â”‚
â”‚  â”€â”€ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆçŠ¶æ…‹ â”€â”€              â”‚
â”‚  çŠ¶æ…‹: æœ‰åŠ¹                        â”‚
â”‚  æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³: 2026-02-22 10:30   â”‚
â”‚  ä½œæˆæ—¥: 2026-01-01               â”‚
â”‚  æ‹›å¾…è€…: -ï¼ˆè‡ªå·±ç™»éŒ²ï¼‰             â”‚
â”‚                                   â”‚
â”‚  â”€â”€ å±é™ºãªæ“ä½œ â”€â”€                  â”‚
â”‚  [ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç„¡åŠ¹åŒ–]              â”‚
â”‚  [ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å‰Šé™¤]                â”‚
â”‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## APIè¨­è¨ˆ

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—

```
GET /api/admin/users?page=1&perPage=10&role=&status=&search=
```

**èªå¯:** ADMIN ã®ã¿
**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```json
{
  "data": [
    {
      "id": "clx...",
      "email": "yamada@example.com",
      "name": "å±±ç”° å¤ªéƒ",
      "role": "ADMIN",
      "status": "active",
      "lastLoginAt": "2026-02-22T10:30:00Z",
      "createdAt": "2026-01-01T00:00:00Z",
      "invitedBy": null
    }
  ],
  "meta": {
    "total": 12,
    "page": 1,
    "perPage": 10
  }
}
```

### ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹›å¾…

```
POST /api/admin/users/invite
```

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**

```json
{
  "email": "newuser@example.com",
  "name": "æ–°è¦ ãƒ¦ãƒ¼ã‚¶ãƒ¼",
  "role": "VIEWER"
}
```

**å‡¦ç†ãƒ•ãƒ­ãƒ¼:**

1. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯
2. è¨±å¯ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯ï¼ˆ`ALLOWED_EMAIL_DOMAINS`ï¼‰
3. `users` ãƒ†ãƒ¼ãƒ–ãƒ«ã« status=`invited` ã§ä½œæˆ
4. æ‹›å¾…ãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼ˆãƒ­ã‚°ã‚¤ãƒ³URLã€‚åˆå›Google SSOæ™‚ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç´ä»˜ã‘ï¼‰

### ãƒ­ãƒ¼ãƒ«å¤‰æ›´

```
PUT /api/admin/users/:id/role
```

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**

```json
{
  "role": "ADMIN"
}
```

**åˆ¶ç´„:**
- ãƒ­ãƒ¼ãƒ«ã¯ `ADMIN` ã¾ãŸã¯ `VIEWER` ã®ã¿
- è‡ªåˆ†è‡ªèº«ã®ãƒ­ãƒ¼ãƒ«ã¯å¤‰æ›´ä¸å¯ï¼ˆèª¤æ“ä½œé˜²æ­¢ï¼‰
- æœ€å¾Œã®ADMINãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ãƒ¼ãƒ«é™æ ¼ã¯ä¸å¯
- å¤‰æ›´æ™‚ã«å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ãƒ¡ãƒ¼ãƒ«é€šçŸ¥

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ç„¡åŠ¹åŒ–

```
PUT /api/admin/users/:id/deactivate
```

**å‡¦ç†:**
- `is_active = false` ã«æ›´æ–°
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å…¨ã¦ç„¡åŠ¹åŒ–
- ãƒ­ã‚°ã‚¤ãƒ³ä¸å¯ã«ãªã‚‹ï¼ˆGoogle SSOæ™‚ã«ãƒã‚§ãƒƒã‚¯ï¼‰

### ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤

```
DELETE /api/admin/users/:id
```

**åˆ¶ç´„:**
- ã‚½ãƒ•ãƒˆãƒ‡ãƒªãƒ¼ãƒˆï¼ˆ`deleted_at` ã«æ—¥æ™‚ã‚’è¨­å®šã€30æ—¥å¾Œã«ç‰©ç†å‰Šé™¤ãƒãƒƒãƒï¼‰
- è‡ªåˆ†è‡ªèº«ã¯å‰Šé™¤ä¸å¯
- æœ€å¾Œã®ADMINã¯å‰Šé™¤ä¸å¯
- ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°å¿…é ˆï¼ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ç¢ºèªï¼‰

---

## æ‹›å¾…ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    actor Admin
    participant UI as æ¨©é™ç®¡ç†ç”»é¢
    participant API as API
    participant DB as DB
    participant Mail as ãƒ¡ãƒ¼ãƒ«é€ä¿¡
    actor NewUser as æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼

    Admin->>UI: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ‹›å¾…" ã‚¯ãƒªãƒƒã‚¯
    Admin->>UI: ãƒ¡ãƒ¼ãƒ«ãƒ»åå‰ãƒ»ãƒ­ãƒ¼ãƒ«ã‚’å…¥åŠ›
    UI->>API: POST /api/admin/users/invite
    API->>API: è¨±å¯ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯
    API->>DB: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ (status: invited, role: VIEWER or ADMIN)
    API->>Mail: æ‹›å¾…ãƒ¡ãƒ¼ãƒ«ï¼ˆãƒ­ã‚°ã‚¤ãƒ³URLï¼‰
    Mail->>NewUser: ãƒ¡ãƒ¼ãƒ«å—ä¿¡
    NewUser->>UI: ãƒ­ã‚°ã‚¤ãƒ³URL â†’ Google SSO
    API->>DB: accounts ãƒ†ãƒ¼ãƒ–ãƒ«ã«ç´ä»˜ã‘ + status: active
```

---

## æ¨©é™ãƒã‚§ãƒƒã‚¯å®Ÿè£…

### ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆãƒšãƒ¼ã‚¸ãƒ¬ãƒ™ãƒ«ï¼‰

```typescript
// src/middleware.ts
import { auth } from '@/lib/auth'
import { NextResponse } from 'next/server'

export default auth((req) => {
  const { pathname } = req.nextUrl

  // ç®¡ç†è€…ãƒšãƒ¼ã‚¸: ADMIN ã®ã¿
  if (pathname.startsWith('/settings') || pathname.startsWith('/api/admin/')) {
    if (req.auth?.user?.role !== 'ADMIN') {
      return NextResponse.redirect(new URL('/dashboard', req.url))
    }
  }

  // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰: ãƒ­ã‚°ã‚¤ãƒ³å¿…é ˆ
  if (pathname.startsWith('/dashboard')) {
    if (!req.auth?.user) {
      return NextResponse.redirect(new URL('/login', req.url))
    }
  }

  return NextResponse.next()
})
```

### APIãƒ¬ãƒ™ãƒ«æ¨©é™ãƒã‚§ãƒƒã‚¯ãƒ˜ãƒ«ãƒ‘ãƒ¼

```typescript
// src/lib/api-auth.ts
import { auth } from '@/lib/auth'
import { NextResponse } from 'next/server'

export async function requireAdmin() {
  const session = await auth()

  if (!session?.user) {
    return NextResponse.json(
      { type: 'UNAUTHORIZED', title: 'èªè¨¼ãŒå¿…è¦ã§ã™', status: 401 },
      { status: 401 },
    )
  }

  if (session.user.role !== 'ADMIN') {
    return NextResponse.json(
      { type: 'FORBIDDEN', title: 'æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“', status: 403 },
      { status: 403 },
    )
  }

  return null // æ¨©é™OK
}
```

---

## Claude Codeå®Ÿè£…ã‚¬ã‚¤ãƒ‰

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â””â”€â”€ users/
â”‚   â”‚       â”œâ”€â”€ page.tsx              # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ç”»é¢
â”‚   â”‚       â””â”€â”€ components/
â”‚   â”‚           â”œâ”€â”€ user-table.tsx     # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«
â”‚   â”‚           â”œâ”€â”€ invite-modal.tsx   # æ‹›å¾…ãƒ¢ãƒ¼ãƒ€ãƒ«
â”‚   â”‚           â”œâ”€â”€ user-detail-panel.tsx # è©³ç´°ãƒ‘ãƒãƒ«
â”‚   â”‚           â””â”€â”€ role-selector.tsx  # ãƒ­ãƒ¼ãƒ«é¸æŠï¼ˆAdmin/Viewerï¼‰
â”‚   â””â”€â”€ api/admin/
â”‚       â””â”€â”€ users/
â”‚           â”œâ”€â”€ route.ts              # GET (ä¸€è¦§)
â”‚           â”œâ”€â”€ [id]/
â”‚           â”‚   â”œâ”€â”€ route.ts          # GET (è©³ç´°), DELETE
â”‚           â”‚   â”œâ”€â”€ role/route.ts     # PUT (ãƒ­ãƒ¼ãƒ«å¤‰æ›´)
â”‚           â”‚   â””â”€â”€ deactivate/route.ts # PUT (ç„¡åŠ¹åŒ–)
â”‚           â””â”€â”€ invite/route.ts       # POST (æ‹›å¾…)
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ api-auth.ts                   # æ¨©é™ãƒã‚§ãƒƒã‚¯ãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼ˆrequireAdminï¼‰
â””â”€â”€ middleware.ts                      # ãƒšãƒ¼ã‚¸ãƒ¬ãƒ™ãƒ«èªå¯
```

### å®Ÿè£…é †åº

1. `src/lib/api-auth.ts` æ¨©é™ãƒã‚§ãƒƒã‚¯ãƒ˜ãƒ«ãƒ‘ãƒ¼ä½œæˆï¼ˆ`requireAdmin`ï¼‰
2. `src/middleware.ts` ã« `/settings` ã¨ `/api/admin/` ã®ä¿è­·ã‚’è¿½åŠ 
3. `src/app/api/admin/users/invite/route.ts` æ‹›å¾…API
4. `src/app/api/admin/users/route.ts` ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§API
5. `src/app/api/admin/users/[id]/role/route.ts` ãƒ­ãƒ¼ãƒ«å¤‰æ›´API
6. `src/app/settings/users/page.tsx` ç®¡ç†ç”»é¢UI
7. `src/app/settings/users/components/*.tsx` å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
8. ãƒ†ã‚¹ãƒˆä½œæˆ

### ãƒ†ã‚¹ãƒˆè¦³ç‚¹

| ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ | æœŸå¾…çµæœ |
|------------|---------|
| ViewerãŒGET /api/admin/usersã«ã‚¢ã‚¯ã‚»ã‚¹ | 403 Forbidden |
| AdminãŒViewerã‚’Adminã«å¤‰æ›´ | 200 OK + ãƒ­ãƒ¼ãƒ«æ›´æ–° |
| AdminãŒè‡ªåˆ†è‡ªèº«ã®ãƒ­ãƒ¼ãƒ«ã‚’å¤‰æ›´ | 400 Bad Request |
| æœ€å¾Œã®Adminã®ãƒ­ãƒ¼ãƒ«é™æ ¼ | 400 Bad Request |
| AdminãŒå­˜åœ¨ã—ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ“ä½œ | 404 Not Found |
| è¨±å¯ãƒ‰ãƒ¡ã‚¤ãƒ³å¤–ã®ãƒ¡ãƒ¼ãƒ«ã§æ‹›å¾… | 400 Bad Request |
| é‡è¤‡ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§æ‹›å¾… | 409 Conflict |
