# フィルタ動的挙動仕様

## フィルタ変更時のデータ再取得

- タイミング: セレクタ系（チャネル・期間・比較モード）は即時反映。DateRangePickerのみ「適用」ボタン押下時
- キャンセル: フィルタ変更中の前回リクエストはAbortControllerでキャンセル
- TanStack Queryのキャッシュキーにフィルタ状態を含め、同一条件の再リクエストはキャッシュから返却

## ローディング表示

| 状況 | 表示方式 |
|------|---------|
| 初回読み込み | スケルトンUI（グラフ・テーブルの形状を模した灰色プレースホルダー） |
| タブ切替 | 対象タブのコンテンツ全体をスケルトン表示 |
| フィルタ変更時 | 部分更新（対象のグラフ/テーブルのみスピナー表示、KPIカードは維持） |
| エクスポート処理中 | ボタン内スピナー + disabled |

## URL連動

- フィルタ状態をURLクエリパラメータに反映（ブックマーク可能）
- パラメータ形式:
  ```
  /dashboard?tab=executive&from=2026-01-15&to=2026-02-14&channel=shopify&period=daily&compareMode=calendar
  ```
- URLからの復元: ページ遷移時にクエリパラメータからフィルタ状態を復元
- タブもURLに含める（`tab=executive`, `tab=channels`, ...）
- 不正なパラメータはデフォルト値にフォールバック

## デフォルト値とリセット

| フィルタ | デフォルト値 |
|---------|------------|
| 期間 | 直近30日 |
| チャネル | 全て（all） |
| 表示期間 | 日次（daily） |
| 比較モード | 暦日（calendar） |
| タブ | エグゼクティブサマリ（executive） |
| ギフトシーズン（タブ6） | 全て（all） |
| 比較種別（タブ9） | 前年比（yoy） |
| 移動平均（タブ9） | なし（none） |

- リセットボタン: 全フィルタをデフォルト値に戻す + URLクエリパラメータクリア
- リセット時もタブは維持する

## フィルタ間の依存関係

| 親フィルタ | 子フィルタ | 挙動 |
|-----------|----------|------|
| チャネル | 商品カテゴリ（タブ7） | チャネルを選択するとそのチャネルの商品カテゴリのみ表示（カスケードフィルタ） |
| ギフトシーズン（タブ6） | 期間 | シーズン選択時に期間をシーズン開始日〜終了日に自動設定 |

依存関係がある場合:
- 親フィルタ変更時に子フィルタの選択肢をAPI取得
- 子フィルタの選択値が新しい選択肢に含まれない場合は「全て」にリセット
